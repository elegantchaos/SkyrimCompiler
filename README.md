[comment]: <> (Header Generated by ActionStatus 2.0.5 - 477)

[![Test results][tests shield]][actions] [![Latest release][release shield]][releases] [![swift 5.5 shield] ![swift dev shield]][swift] ![Platforms: macOS][platforms shield]

[release shield]: https://img.shields.io/github/v/release/elegantchaos/SkyrimFileFormat
[platforms shield]: https://img.shields.io/badge/platforms-macOS-lightgrey.svg?style=flat "macOS"
[tests shield]: https://github.com/elegantchaos/SkyrimFileFormat/workflows/Tests/badge.svg
[swift 5.5 shield]: https://img.shields.io/badge/swift-5.5-F05138.svg "Swift 5.5"
[swift dev shield]: https://img.shields.io/badge/swift-dev-F05138.svg "Swift dev"

[swift]: https://swift.org
[releases]: https://github.com/elegantchaos/SkyrimFileFormat/releases
[actions]: https://github.com/elegantchaos/SkyrimFileFormat/actions

[comment]: <> (End of ActionStatus Header)

# SkyrimFileFormat

This is a very early work-in-progress.

The objective is to product a library (and command line tool), which can take a directory structure composed of text "source" files, and compile it into an `.esp` file. The reverse direction (`.esp` to source) is also an essential step and will be supported.

Given the complexity of the format, the initial goal is not to support direct editing of every single record type.

Parsing of specific record and field types will be slowly expanded, but a fallback option will take the binary content of unknown fields and convert them to/from hex-encoded text.

The advantage of this approach is that round-tripping can be implemented quite cheaply (it is already working, in fact), whereas full support for every single field and record type will take months or years of work.

## Primary Goals

One motivation for this tool is to enable esp development to be managed by source control.

Another is to allow a simple way to perform small manual edits to an esp.

However, probably the primary motivation is to enable easier development of other tools.

By removing the need to parse and understand the binary format, it should be simpler to produce tools
which can:

- generate esps
- extract items from esps
- modify specific record types

This should make it easier to develop small focussed tools that have a specific purpose. Hopefully that will lower the entry barrier for tool development, which is currently pretty high (tools like xEdit or CreationKit are enourmous monsters).

# Secondary Goals

The code is written in Swift*, which is primarily known as a language used to develop iOS/macOS apps. I aim to make it fully cross-platform however. This may be of more interest in the context of OpenMW than it is for Skyrim modders, but as a relatively low-level library, there seems no reason why it couldn't be platform neutral.

The hope is that tools can just read/write the text format, and then invoke this compiler. However, it also makes sense to supply the functionality as a shared library / dll, so I aim to do that.

Where possible, the textual file format will aim to hide complexity of the underlying binary file format. As a trivial example, if you've got an array of something, the binary format will probably also have a count stored alongside it; the textual file format won't need this, and can generate the count during compilation. 

There are far more complex examples where the binary format changes based on context (version number, for example). In this case the text format will hide the complexity where it can, and provide a higher-level abstraction which can be decompiled/recompiled. Hopefully a side-effect of this will be a clean way to upgrade an old ESP to use the newest binary encoding.

All of this is really a means to an end - in that there are other tools that I want to write which will sit on top of this. As such, I aim to make the code in this library as accessible as possible, whilst still trying to keep the scope as narrow as possible.

(* because that's what I use in my day job)

### Not Just Skyrim

I'm initially focussed on Skyrim SE/AE, because that's what I play. In theory though this tool could support the whole family of games using `.esp` files.

In particular, adopting a tool like this for OpenMW might make a lot more sense than trying to reproduce CreationKit warts-and-all.

### Similar Projects

There are at least a couple of projects aiming at similar things:

- https://github.com/Greatness7/tes3conv
- https://gitlab.com/bmwinger/delta-plugin

I didn't know about them when I started mine, and of course we all have our own agendas, motivations, areas of expertise and language preferences. 

That said, I'd be up for collaborating if we could figure out some places where it would make sense.

### References

File format reference: https://en.uesp.net/wiki/Skyrim_Mod:Mod_File_Format
